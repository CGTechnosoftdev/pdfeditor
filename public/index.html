<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Web site created using create-react-app" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
  <link href='https://fonts.googleapis.com/css' rel='stylesheet'>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" />
  <link rel="stylesheet" href="./styles.css">
  <link rel="stylesheet" href="./pdfannotate.css">
  <link rel="stylesheet" href="./signature-pad.css">
  <link rel="stylesheet" href="./text_layer_builder.css">
  <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/    -->

  <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
  <title>PDF Writer</title>
</head>

<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root" style="display: none;"></div>

  <div>
    <section class="toolbar">

      <div class="logo">
        <h3>PDF Editor</h3>
      </div>
      <div class="toolbar-top">

        <div class="tool border-0">
          <label for="">Brush size</label>
          <input type="number" class="form-control text-right" value="1" id="brush-size" max="50">
        </div>

        <div class="tool border-0" style="width: 85px;">
          <!-- <button class="color-tool active" style="background-color: #212121;"></button>
          <button class="color-tool" style="background-color: red;"></button>
          <button class="color-tool" style="background-color: blue;"></button>
          <button class="color-tool" style="background-color: green;"></button>
          <button class="color-tool" style="background-color: yellow;"></button> -->
          <input type="color" id="html5colorpicker" onchange="clickColor(0, -1, -1, 5)" value="#000000"
            style="width:100%; height: 25px;">
        </div>

        <div class="tool" onclick="enableSelector(event)" title="Free Hand">
          <button class="tool-button active"><i class="fa fa-hand-paper-o"></i></button>
        </div>

        <div class="tool" title="Image">
          <button class="tool-button" id="openImageModelId"><i class="fa fa-picture-o"></i></button>
        </div>

        <div class="tool">
          <button onclick="enablePencil(event)" title="Pencil" class="tool-button"><i class="fa fa-pencil"></i></button>
        </div>

        <div class="tool" title="Add Text">
          <button class="tool-button"><i class="fa fa-font" onclick="enableAddText(event)"></i></button>
        </div>

        <div class="tool" onclick="enableAddArrow(event)">
          <button title="Add Arrow" class="tool-button"><i class="fa fa-long-arrow-right"></i></button>
        </div>

        <div class="tool" onclick="changeFontWeight(event)">
          <button title="Bold" class="tool-button" id="bold"><i class="fa fa-bold"></i></button>
        </div>

        <div class="tool" onclick="enableRectangle(event)">
          <button title="Add rectangle" class="tool-button"><i class="fa fa-square-o"></i></button>
        </div>

        <div class="tool">
          <button title="Erase" class="tool-button" id="eraser_btn_id"><i class="fa fa-eraser"></i></button>
        </div>

        <div class="tool">
          <button class="tool-button" title="Highlighter" id="highlight_btn_id"><i class="fa fa-eye"></i>
          </button>
        </div>

        <div class="tool">
          <button title="Blackout" class="tool-button" id="blackout_btn_id"><i class="fa fa-eye"></i></button>
        </div>

        <div class="tool" onclick="openSignatureModal(event)">
          <button class="tool-button" title="Add Signature">
            <img width="20px" src="signature.svg" alt="Add Signature" />
          </button>
        </div>

        <div class="tool" onclick="openCustomDrawModal(event)">
          <button class="tool-button" title="Custom Draw">
            <img width="20px" src="signature.svg" alt="Custom Draw" />
          </button>
        </div>

        <div class="tool">
          <input id="input_pdf_file" type="file">
        </div>

        <div class="tool">
          <button class="tool-button" id="pick_date_button" title="Add Date">
            <img width="20px" src="date.svg" alt="Add Date" />
          </button>
        </div>

        <div class="tool">
          <button class="tool-button" id="resize_canvas" title="Resize Page">
            <img width="20px" src="date.svg" alt="Add Date" />
          </button>
        </div>

        <div class="tool" onclick="addDate(event)">
          <button class="tool-button" title="Add Date">
            <img width="20px" src="date.svg" />
          </button>
        </div>

        <div class="float-right" onclick="deleteSelectedObject(event)">
          <div class="tool border-0">
            <button class="btn btn-danger btn-sm"><i class="fa fa-trash"></i></button>
          </div>

          <div class="tool border-0">
            <button class="btn btn-secondary btn-sm" onclick="clearPage()">Clear Page</button>
          </div>

          <div class="tool border-0">
            <button class="btn btn-info btn-sm" onclick="showPdfData()">{}</button>
          </div>

          <div class="tool border-0">
            <button class="btn btn-primary btn-sm" onclick="savePDF()"><i class="fa fa-save"></i> Save</button>
          </div>
        </div>
      </div>
      <div class="toolbar-bottom">

        <div class="tool border-0">
          <select onchange="changeFontSize(event)" id="font-size" class="form-control">
            <option value="10">10</option>
            <option value="12">12</option>
            <option value="16" selected>16</option>
            <option value="18">18</option>
            <option value="24">24</option>
            <option value="32">32</option>
            <option value="48">48</option>
            <option value="64">64</option>
            <option value="72">72</option>
            <option value="108">108</option>
          </select>
        </div>

        <div class="tool border-0">
          <select id="font-family" class="form-control">
            <option value="Arial">Arial</option>
            <option value="Courier">Courier</option>
            <option value="MS Gothic">MS Gothic</option>
          </select>
        </div>

        <div class="tool" id="toggleitalicid">
          <button title="Italic" class="tool-button"> <i class="fa fa-italic"></i></button>
        </div>

        <div class="tool" id="toggleunderline">
          <button title="Underline" class="tool-button"> <i class="fa fa-underline"></i> </button>
        </div>

        <div class="tool" onclick="addCrossIcon()">
          <button title="Add Cross Icon" class="tool-button"> <i class="fa fa-times"></i> </button>
        </div>

        <div class="tool" onclick="addCircleIcon()">
          <button title="Add Circle Icon" class="tool-button"> <i class="fa fa-circle-o"></i> </button>
        </div>

        <div class="tool" onclick="addCheckIcon()">
          <button title="Add Check Icon" class="tool-button"> <i class="fa fa-check"></i> </button>
        </div>

        <div class="tool" onclick="addPage()">
          <button class="tool-button">
            Add Page
          </button>
        </div>

        <div class="tool" onclick="rotatePage()">
          <button class="tool-button" title="Rotate Page">
            <i class="fa fa-rotate-right"></i>
          </button>
        </div>

        <div class="tool" onclick="deletePage()">
          <button class="tool-button">
            Delete Page
          </button>
        </div>

        <div class="tool" onclick="addWatermark()">
          <button class="tool-button">
            Add Watermark
          </button>
        </div>

        <div class="tool" onclick="duplicatePage()">
          <button class="tool-button" title="Duplicate Page">
            <i class="fa fa-copy"></i>
          </button>
        </div>

        <div class="tool" onclick="movePage('up')">
          <button class="tool-button" title="Move up">
            <i class="fa fa-long-arrow-up"></i>
          </button>
        </div>

        <div class="tool" onclick="movePage('down')">
          <button class="tool-button" title="Move down">
            <i class="fa fa-long-arrow-down"></i>
          </button>
        </div>

      </div>

    </section>
    <div id="pdf-container" style="display: none;">
    </div>
    <div class="custom-pdf-container" id="custom-pdf-container">
      <div id="from-content-pdf">
        <!-- <form id="from-content-pdf-form"> -->
        <label for="fname">First name:</label><br>
        <input type="text" id="fname" name="fname" value="John"><br>
        <label for="lname">Last name:</label><br>
        <input type="text" id="lname" name="lname" value="Doe"><br><br>
        <button class="btn btn-primary btn-sm" onclick="savePDF()"><i class="fa fa-save"></i> Save</button>
        <!-- </form> -->
      </div>
    </div>
    <!-- <canvas id="the-canvas"></canvas> -->
    <div>
      <form id="fieldsForm">
        Choose field:
        <select id="selectField" onchange="eval(this.value);">
        </select>
        <h3>PDF Forms list...</h3>
        <div id="dy-form"></div>
      </form>
    </div>

    <div id="the-pdf"></div>
    <div id="">

    </div>
  </div>

  <div class="modal fade" id="dataModal" tabindex="-1" role="dialog" aria-labelledby="dataModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="dataModalLabel">PDF annotation data</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <pre class="prettyprint lang-json linenums">
            </pre>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="watermarkModal" tabindex="-1" role="dialog" aria-labelledby="watermarkModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="watermarkModalLabel">Please enter text for watermark</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <input type="text" maxlength="20" name="watermark" id="watermark" value="" />
          <p id="watermark-msg" class="text-danger" style="display: none;">Please enter text for watermark.</p>
          <div class="mt-3 orientation_group">
            <h6>Choose Orientation</h6>
            <input type="hidden" id="orientation" value="quarter" />
            <img class="active" data-value="quarter" width="40px" src="turned-quarter.svg" style="border: 1px solid;" />
            <img width="40px" data-value="half" src="turned-half.svg" style="border: 1px solid;" />
            <img width="40px" data-value="normal" src="normal.svg" style="border: 1px solid;" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" id="submit">OK</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="signatureModal" tabindex="-1" role="dialog" aria-labelledby="dataModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="dataModalLabel">Draw/Import signature</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <input type="file" name="signature" value="" id="signature-selector" onchange="selectSignature(event)" />
          <button name="button" type="button" onclick="enableDrawingMode()" class="btn btn-primary">Draw</button>
          <div class="signature-wrapper">
            <canvas id="signature-pad" class="signature-pad" width=400 height=200></canvas>
          </div>
          <div class="img-wrapper" style="display: none;">
            <img src="" height="200" width="150" alt="image preview" id="preview-sign" />
          </div>
          <img src="" height="200" id="drawed-signature" style="display: none;" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary clear" id="clear" data-action="clear">Clear</button>
          <button type="button" class="btn btn-secondary clear" id="undo" data-action="undo">Undo</button>
          <button type="button" class="btn btn-primary" id="save-png">Save & Use</button>
          <button type="button" class="btn btn-primary" id="use-sign" style="display: none;">Use</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="customDrawModal" tabindex="-1" role="dialog" aria-labelledby="dataModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="dataModalLabel">Custom Draw</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="customDraw-wrapper">
            <canvas id="customDraw-pad" class="customDraw-pad" width=400 height=200></canvas>
          </div>
          <div class="img-wrapper" style="display: none;">
            <img src="" height="200" width="150" alt="image preview" id="preview-sign" />
          </div>
          <img src="" height="200" id="drawed-customDraw" style="display: none;" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary clear" id="custom-clear" data-action="clear">Clear</button>
          <button type="button" class="btn btn-secondary clear" id="custom-undo" data-action="undo">Undo</button>
          <button type="button" class="btn btn-primary" id="custom-save-png">Use</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="dataModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="dataModalLabel">Import Image</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <input type="file" name="newimage" value="" id="image-selector" onchange="selectImage(event)" />
          <div id="PreviousContainer" style="display:none">
            <h4>You can select previous selected image.</h4>
            <div class="row" id="PreviousImageContainer">
            </div>
          </div>
          <div class="new-img-wrapper" style="display: none;">
            <img src="" height="200" width="150" alt="image preview" id="preview-image" />
          </div>
          <img src="" height="200" id="drawed-signature" style="display: none;" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="new-img-save-png">Save & Use</button>
        </div>
      </div>
    </div>
  </div>
  <div id="newImageTemplateId">
    <div class="col col-md-3" style="display:none">
      <div class="newImgItem">-imgItem-</div>
    </div>
  </div>
  <!--Select Date Model-->
  <div class="modal fade" id="selectdateModal" tabindex="-1" role="dialog" aria-labelledby="dataModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="dataModalLabel">Select Date</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body form-group">
          <div class="alert  hide" id="select_date_msg_id"></div>
          <div class="row">
            <div class="col col-md-3"> <label class="label label-default">Date</label>
            </div>
            <div class="col col-md-6"><input type="text" name="date" id="dateid" class="form-control"
                autocomplete="off" /></div>
          </div>
          <div class="row">
            <div class="col col-md-3"> <label>Header Or Footer</label>
            </div>
            <div class="col col-md-6">
              <select name="header_footer" id="header_footerid" class="form-control">
                <option value="0">--Select--</option>
                <option value="1">Header</option>
                <option value="2">Footer</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col col-md-3"> <label>Align</label>
            </div>
            <div class="col col-md-6">
              <select name="text_align" id="text_alignid" class="form-control">
                <option value="0">--Select--</option>
                <option value="1">Left</option>
                <option value="2">Right</option>
                <option value="3">Center</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="new-date-select-button">Select</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="setpagesizeModal" tabindex="-1" role="dialog" aria-labelledby="dataModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="dataModalLabel">Page Size</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body form-group">
          <div class="alert  hide" id="setuppage_msg_id"></div>
          <div class="row">
            <div class="col col-md-3"> <label>Width</label>
            </div>
            <div class="col col-md-6">
              <input type="number" name="page_width" id="page_widthid" class="form-control" value="" />
            </div>
          </div>
          <div class="row">
            <div class="col col-md-3"> <label>Height</label>
            </div>
            <div class="col col-md-6">
              <input type="number" name="page_height" id="page_heightid" class="form-control" value="" />
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="new-width-height-button">Submit</button>
        </div>
      </div>
    </div>
  </div>
  <!--Select Date Model End-->
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.0.328/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.7.22/fabric.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js"></script>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<script src="./arrow.fabric.js"></script>
<script src="https://unpkg.com/pdf-lib@1.11.0"></script>
<script src="https://unpkg.com/downloadjs@1.4.7"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
<script src="./lib/pdfkit.js"></script>
<script src="./lib/blob-stream.js"></script>
<script src="//mozilla.github.io/pdf.js/build/pdf.js"></script>
<!-- <script src="./pdf.worker.js"></script> -->
<script src="./canvas2pdf.js"></script>
<script src="./pdfannotate.js"></script>
<script src="./script.js"></script>
<script src="./text_layer_builder.js"></script>

<script>
  $(document).ready(function () {
    setTimeout(() => {
      loadFromJson()
    }, 2000);
    $('#dateid').datepicker({
      format: "dd/mm/yyyy",
      autoclose: true,
    });

    $('.dateid').on('click', function (e) {
      e.preventDefault();
      $(this).attr("autocomplete", "off");
    });

  });
  let pdfRotate = 0;
  let pdfPageHeight = 0;
  let pageNum = 1;
  function convertToBase64(inputPDFFile) {
    return new Promise((resolve, reject) => {
      try {
        //Check File is not Empty
        if (inputPDFFile) {
          // Select the very first file from list
          var fileToLoad = inputPDFFile;
          // FileReader function for read the file.
          var fileReader = new FileReader();
          var base64;
          // Onload of file read the file content
          fileReader.onload = function (fileLoadedEvent) {
            base64 = fileReader.result;
            // Print data in console
            console.log(base64);
            resolve(btoa(base64));
          };
          // Convert data to base64
          fileReader.readAsDataURL(fileToLoad);
        }
      }
      catch (e) {
        reject(e);
      }
    })
  }
  function removeOptions(selectbox) {
    var i;
    for (i = selectbox.options.length - 1; i >= 0; i--) {
      selectbox.remove(i);
    }
  }
  /**
       * If another page rendering in progress, waits until the rendering is
       * finised. Otherwise, executes rendering immediately.
       */
  function queueRenderPage(num, xOffset, yOffset) {
    if (pageRendering) {
      pageNumPending = num;
      pageLeftPending = xOffset;
      pageTopPending = yOffset;
    } else {
      renderPage(num, xOffset, yOffset, false);
    }
  }
  function addSelectBoxForPageAcroFieldsToForm(page) {
    page.getAnnotations().then(
      function (items) {
        var selectField = document.getElementById("selectField");
        removeOptions(selectField);
        var optionsHTML = [];
        if (items.length == 0) {
          optionsHTML.push("<option value=\"console.log('no fields clicked - doing nothing');\">No fields</option>");
        }
        for (var i = 0; i < items.length; i++) {
          var item = items[i];
          console.log("form fields work..", item)
          switch (item.subtype) {
            case 'Widget':
              if (item.fieldType != 'Tx' && item.fieldType != 'Btn' && item.fieldType != 'Ch') {
                break;
              }
              var fieldName;
              if (item.fieldType == 'Tx') {
                fieldName = 'Inputfield with key ' + item.fieldName + ' (position: ' + item.rect + ')';
                var input = document.createElement("input");
                input.type = "text";
                input.name = item.fieldName;
                input.value = item.fieldValue;
                input.style.left = item.rect[0] + "px";
                input.style.top = item.rect[1] + "px";
                document.getElementById('dy-form').appendChild(input);
              }
              if (item.fieldType == 'Btn') {
                if (item.fieldFlags == 32768) {
                  fieldName = 'Radiobutton with key ' + item.fieldName + ' (position: ' + item.rect + ')';
                  // create radio btn
                  var radioHtml = '<input type="radio" name="' + item.fieldName + '"';
                  if (item.fieldValue == item.buttonValue) {
                    radioHtml += ' checked="checked"';
                  }
                  radioHtml += '/>';
                  var radioFragment = document.createElement('div');
                  radioFragment.innerHTML = radioHtml;
                  document.getElementById('dy-form').appendChild(radioFragment);
                } else if (item.flags & 65536) {
                  fieldName = 'Pushbutton with key ' + item.fieldName + ' (position: ' + item.rect + ')';
                  // create button
                  var btn = document.createElement("BUTTON");
                  btn.id = 'btn' + item.id;
                  btn.setAttribute("value", item.fieldName);
                  btn.setAttribute("text", item.fieldName);
                  btn.style.fontSize = "14px";
                  btn.style.backgroundColor = '#4CAF50';
                  document.getElementById('dy-form').appendChild(btn);
                } else {
                  fieldName = 'Checkbox with key ' + item.fieldName + ' (position: ' + item.rect + ')';
                  // create checkbox
                  var checkbox = document.createElement('input');
                  checkbox.type = "checkbox";
                  checkbox.name = item.fieldName;
                  checkbox.value = item.fieldValue;
                  checkbox.checked = item.fieldValue == "Yes" ? true : false;
                  checkbox.id = item.id;
                  var label = document.createElement('label')
                  label.htmlFor = item.id + "_label";
                  label.appendChild(document.createTextNode(item.fieldName));
                  document.getElementById('dy-form').appendChild(checkbox);
                  document.getElementById('dy-form').appendChild(label);
                }
              }
              if (item.fieldType == 'Ch') {
                fieldName = 'Selectbox with key ' + item.fieldName + ' (position: ' + item.rect + ')';
                let fieldValue = item.fieldValue.length ? item.fieldValue[0] : "";
                console.log(fieldValue)
                // var selectObj = document.getElementById('Select1').value;
                var newDiv = document.createElement('div');
                var html = '<select name="' + item.fieldName + '" value="' + fieldValue + '">';
                if (item.options) {
                  for (j = 0; j < item.options.length; j++) {
                    let selectedVal = fieldValue == item.options[j].exportValue ? 'selected' : ''
                    html += "<option value='" + item.options[j].exportValue + "' " + selectedVal + ">" + item.options[j].displayValue + "          </option>";
                  }
                }
                html += '</select>';
                newDiv.innerHTML = html;
                document.getElementById('dy-form').appendChild(newDiv);
              }

            // x = item.rect[0];
            // if (pdfRotate == 90) {
            //   y = pdfPageWidth - item.rect[1];
            // }
            // else if (pdfRotate == 0) {
            //   y = pdfPageHeight - item.rect[1];
            // }
            // else {
            //   //TODO: other rotates
            // }
            // optionsHTML.push("<option value=\"queueRenderPage(" + pageNum + "," + x + "," + y + ");\">" + fieldName + "</option>");
          }
        }
        selectField.innerHTML = optionsHTML.join('\n');
      });
  }
  function logAcroFormsToConsoleFor(page) {
    page.getAnnotations().then(
      function (items) {
        for (var i = 0; i < items.length; i++) {
          var item = items[i];
          switch (item.subtype) {
            case 'Widget':
              if (item.fieldType != 'Tx' && item.fieldType != 'Btn' && item.fieldType != 'Ch') {
                break;
              }
              if (item.fieldType == 'Tx') {
                console.log('found inputfield with key ' + item.fullName + ' (position: ' + item.rect + ')');
              }
              if (item.fieldType == 'Btn') {
                if (item.flags & 32768) {
                  console.log('found radio button with key ' + item.fullName + ' (position: ' + item.rect + ')');
                } else if (item.flags & 65536) {
                  console.log('found pushbutton with key ' + item.fullName + ' (position: ' + item.rect + ')');
                } else {
                  console.log('found checkbox with key ' + item.fullName + ' (position: ' + item.rect + ')');
                }
              }
              if (item.fieldType == 'Ch') {
                console.log('found select box with key ' + item.fullName + ' (position: ' + item.rect + ')');
              }
          }
        }
      });
  }
  jQuery("#input_pdf_file").change(async function () {
    // alert(jQuery(this).val())
    // let inputPDFFile = document.getElementById('input_pdf_file').files[0];
    var inputPDFFile = $('#input_pdf_file')[0].files[0]
    console.log(inputPDFFile, inputPDFFile.type)
    let pdfDoc = null;
    if (inputPDFFile && inputPDFFile.type == "application/pdf") {
      console.log(inputPDFFile)
      let byteArray = await fileToByteArray(inputPDFFile);
      // console.log(btoa(byteArray))

      var pdfjsLib = window['pdfjs-dist/build/pdf'];
      // The workerSrc property shall be specified.
      pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';

      // CanvasRenderingContext2D.prototype.strokeText = function () { };
      // CanvasRenderingContext2D.prototype.fillText = function () { };

      // Asynchronous download PDF
      var loadingTask = pdfjsLib.getDocument({ data: byteArray });

      // console.log(loadingTask)
      var thePdf = null;
      var scale = 1;
      loadingTask.promise.then(function (pdf) {
        // Get div#container and cache it for later use
        var container = document.getElementById("the-pdf");
        container.innerHTML = "";
        document.getElementById('dy-form').innerHTML = "";
        // Get div#container and cache it for later use
        // var container = document.getElementById("container");

        // Loop from 1 to total_number_of_pages in PDF document
        for (var i = 1; i <= pdf.numPages; i++) {

          // Get desired page
          pdf.getPage(i).then(function (page) {
            pageNum = i;
            // console all forms list
            // logAcroFormsToConsoleFor(page)
            pdfRotate = page.rotate;
            var scale = 1.5;
            var viewport = page.getViewport({ scale: scale });
            // var pdfViewBox = page.pageInfo.view;
            // var viewport = new PDFJS.PageViewport(pdfViewBox, scale, page.rotate);
            var div = document.createElement("div");

            // Set id attribute with page-#{pdf_page_number} format
            div.setAttribute("id", "page-" + (page._pageIndex + 1));

            // This will keep positions of child elements as per our needs
            div.setAttribute("style", "position: relative");

            // Append div within div#container
            container.appendChild(div);

            // Create a new Canvas element
            var canvas = document.createElement("canvas");

            // Append Canvas within div#page-#{pdf_page_number}
            div.appendChild(canvas);

            var context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            var renderContext = {
              canvasContext: context,
              viewport: viewport
            };

            // Render PDF page
            // page.render(renderContext);
            var renderTask = page.render(renderContext);
            renderTask.promise.then(function () {
              addSelectBoxForPageAcroFieldsToForm(page);
              page.getTextContent()
                .then(function (textContent) {
                  // Create div which will hold text-fragments
                  var textLayerDiv = document.createElement("div");

                  // Set it's class to textLayer which have required CSS styles
                  textLayerDiv.setAttribute("class", "textLayer");

                  // Append newly created div in `div#page-#{pdf_page_number}`
                  div.appendChild(textLayerDiv);

                  // Create new instance of TextLayerBuilder class
                  var textLayer = new TextLayerBuilder({
                    textLayerDiv: textLayerDiv,
                    pageIndex: page.pageIndex,
                    viewport: viewport
                  });

                  // Set text-fragments
                  textLayer.setTextContent(textContent);

                  // Render text-fragments
                  textLayer.render();
                });
            });
          });
        }

      }, function (reason) {
        // PDF loading error
        console.error(reason);
      });

    } else {
    }
  });

  $(document).ready(function () {
    // PDFJS.workerSrc = "./pdf_worker.worker.js";
    return;
    console.log(PDFJS.workerSrc)
    // URL of PDF document
    var demoPdfUrl = 'http://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf';
    var pdfjsLib = window['pdfjs-dist/build/pdf'];
    // The workerSrc property shall be specified.
    pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';

    CanvasRenderingContext2D.prototype.strokeText = function () { };
    CanvasRenderingContext2D.prototype.fillText = function () { };

    // Asynchronous download PDF
    var loadingTask = pdfjsLib.getDocument(demoPdfUrl);
    // loadingTask.promise.then(function (pdf) {
    //   console.log('PDF loaded');

    //   // Fetch the first page
    //   var pageNumber = 1;
    //   pdf.getPage(pageNumber).then(function (page) {
    //     console.log('Page loaded');

    //     var scale = 1.5;
    //     var viewport = page.getViewport({ scale: scale });

    //     // Prepare canvas using PDF page dimensions
    //     var canvas = document.getElementById('the-canvas');
    //     var context = canvas.getContext('2d');
    //     canvas.height = viewport.height;
    //     canvas.width = viewport.width;

    //     // Render PDF page into canvas context
    //     var renderContext = {
    //       canvasContext: context,
    //       viewport: viewport
    //     };
    //     var renderTask = page.render(renderContext);
    //     renderTask.promise.then(function () {
    //       console.log('Page rendered');
    //     });
    //   });
    console.log(loadingTask)
    var thePdf = null;
    var scale = 1;
    loadingTask.promise.then(function (pdf) {
      // Get div#container and cache it for later use
      var container = document.getElementById("the-pdf");

      // Get div#container and cache it for later use
      // var container = document.getElementById("container");

      // Loop from 1 to total_number_of_pages in PDF document
      for (var i = 1; i <= pdf.numPages; i++) {

        // Get desired page
        pdf.getPage(i).then(function (page) {

          var scale = 1.5;
          var viewport = page.getViewport({ scale: scale });
          var div = document.createElement("div");

          // Set id attribute with page-#{pdf_page_number} format
          div.setAttribute("id", "page-" + (page._pageIndex + 1));

          // This will keep positions of child elements as per our needs
          div.setAttribute("style", "position: relative");

          // Append div within div#container
          container.appendChild(div);

          // Create a new Canvas element
          var canvas = document.createElement("canvas");

          // Append Canvas within div#page-#{pdf_page_number}
          div.appendChild(canvas);

          var context = canvas.getContext('2d');
          canvas.height = viewport.height;
          canvas.width = viewport.width;

          var renderContext = {
            canvasContext: context,
            viewport: viewport
          };

          // Render PDF page
          // page.render(renderContext);
          var renderTask = page.render(renderContext);
          renderTask.promise.then(function () {
            page.getTextContent()
              .then(function (textContent) {
                // Create div which will hold text-fragments
                var textLayerDiv = document.createElement("div");

                // Set it's class to textLayer which have required CSS styles
                textLayerDiv.setAttribute("class", "textLayer");

                // Append newly created div in `div#page-#{pdf_page_number}`
                div.appendChild(textLayerDiv);

                // Create new instance of TextLayerBuilder class
                var textLayer = new TextLayerBuilder({
                  textLayerDiv: textLayerDiv,
                  pageIndex: page.pageIndex,
                  viewport: viewport
                });

                // Set text-fragments
                textLayer.setTextContent(textContent);

                // Render text-fragments
                textLayer.render();
              });
          });
        });
      }

    }, function (reason) {
      // PDF loading error
      console.error(reason);
    });
  })
</script>

<style>
  .datepicker.datepicker-dropdown {
    top: 60px !important;
  }
</style>

</html>